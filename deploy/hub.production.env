# MCP Agent Hub production profile.
# Auto-loaded by ./hub.sh when this file exists.
# Override with: MCP_HUB_ENV_FILE=/path/to/custom.env ./hub.sh start

# Network bind policy is controlled by hub.sh:
# - localhost (127.0.0.1) is always published
# - optional extra interface binds come from deploy/hub.local.env (gitignored)
#   via MCP_HUB_EXTRA_BIND_HOSTS=ip1,ip2

# --- Session reliability (no reconnects on idle) ---
# 0 disables idle session eviction in server memory.
MCP_HUB_SESSION_IDLE_TIMEOUT_MS=0
# Keep compatibility path for stale/unknown mcp-session-id.
MCP_HUB_UNKNOWN_SESSION_POLICY=stateless_fallback
# Keep interval set in case idle timeout is turned on later.
MCP_HUB_SESSION_GC_INTERVAL_MS=60000

# --- Polling / transport efficiency ---
# Default all wait_for_updates responses to nano payloads.
MCP_HUB_WAIT_DEFAULT_RESPONSE_MODE=nano
# Minimal timeout payload to cut empty-poll overhead.
MCP_HUB_WAIT_DEFAULT_TIMEOUT_RESPONSE=minimal
MCP_HUB_WAIT_DEFAULT_MS=10000
MCP_HUB_WAIT_MAX_MS=25000
MCP_HUB_WAIT_RETRY_FACTOR=1.5
MCP_HUB_WAIT_RETRY_CAP_MS=10000
MCP_HUB_WAIT_RETRY_JITTER_PCT=0.2
# Disable verbose wait logs in steady-state production.
MCP_HUB_WAIT_LOG_HITS=false
MCP_HUB_WAIT_LOG_TIMEOUTS=false

# SSE push loop defaults (for /events channel).
MCP_HUB_EVENT_STREAM_INTERVAL_MS=750
MCP_HUB_EVENT_STREAM_HEARTBEAT_MS=15000

# --- Compression / payload optimization ---
MCP_HUB_AUTO_PACK_MIN_PAYLOAD_CHARS=1536
MCP_HUB_AUTO_PACK_MIN_GAIN_PCT=3
MCP_HUB_LOSSLESS_AUTO_MIN_PAYLOAD_CHARS=768
MCP_HUB_LOSSLESS_AUTO_MIN_GAIN_PCT=2

# --- Throughput and fairness ---
# Per-agent request budget.
MCP_HUB_RATE_LIMIT_RPS=120
MCP_HUB_RATE_LIMIT_BURST=240
# Namespace governance and quotas (warn mode is safer for rollout).
MCP_HUB_NAMESPACE_GOVERNANCE=warn
MCP_HUB_NAMESPACE_QUOTA_MODE=warn
MCP_HUB_NAMESPACE_QUOTA_RPS=120
MCP_HUB_NAMESPACE_QUOTA_BURST=240
MCP_HUB_NAMESPACE_TOKEN_BUDGET_PER_MIN=400000
MCP_HUB_NAMESPACE_QUOTA_FALLBACK=default

# --- Security ---
# Enforce valid auth_token on every tool call except register_agent.
MCP_HUB_AUTH_MODE=enforce

# --- Coordination defaults ---
MCP_HUB_DEFAULT_ONBOARDING_MODE=compact
MCP_HUB_EPHEMERAL_DEFAULT_ONBOARDING_MODE=compact
MCP_HUB_REREGISTER_ONBOARDING_MODE=none
MCP_HUB_CONSISTENCY_DEFAULT=cheap
MCP_HUB_DISALLOW_FULL_IN_POLLING=1
MCP_HUB_DONE_EVIDENCE_MIN_REFS=1
MCP_HUB_STRICT_DONE_CONFIDENCE_MIN=0.9
MCP_HUB_STRICT_DONE_EVIDENCE_MIN_REFS=1

# --- Housekeeping / retention ---
MCP_HUB_MAINTENANCE_INTERVAL_MS=30000
MCP_HUB_IDEMPOTENCY_TTL_MS=600000
MCP_HUB_CLAIM_CLEANUP_THROTTLE_MS=5000
MCP_HUB_AGENT_OFFLINE_AFTER_MS=1800000
MCP_HUB_AGENT_RETENTION_MS=604800000
MCP_HUB_EPHEMERAL_OFFLINE_AFTER_MS=300000
MCP_HUB_EPHEMERAL_AGENT_RETENTION_MS=7200000
MCP_HUB_EPHEMERAL_CLAIM_REAP_AFTER_MS=600000
MCP_HUB_MESSAGE_TTL_MS=86400000
MCP_HUB_ACTIVITY_LOG_TTL_MS=86400000
MCP_HUB_PROTOCOL_BLOB_TTL_MS=604800000
MCP_HUB_ARTIFACT_TTL_MS=604800000
MCP_HUB_DONE_TASK_TTL_MS=604800000
MCP_HUB_AUTH_EVENTS_TTL_MS=604800000
MCP_HUB_RESOLVED_SLO_TTL_MS=1209600000
MCP_HUB_ARCHIVE_BATCH_LIMIT=500

# SLO thresholds.
MCP_HUB_SLO_PENDING_AGE_MS=1800000
MCP_HUB_SLO_STALE_IN_PROGRESS_MS=1200000
MCP_HUB_SLO_CLAIM_CHURN_WINDOW_MS=600000
MCP_HUB_SLO_CLAIM_CHURN_THRESHOLD=120

# Watermark cache tuning for read_snapshot/wait_for_updates.
MCP_HUB_WATERMARK_CACHE_MS=100
MCP_HUB_WATERMARK_AGENT_CACHE_MAX=10000

# --- Limits / safety caps ---
MCP_HUB_MAX_MESSAGE_CONTENT_CHARS=1024
MCP_HUB_MAX_MESSAGE_METADATA_CHARS=1024
MCP_HUB_MAX_CONTEXT_VALUE_CHARS=2048
MCP_HUB_MAX_PROTOCOL_BLOB_CHARS=32768
MCP_HUB_MAX_CONSENSUS_VOTES=1000
MCP_HUB_CONSENSUS_QUALITY_WEIGHTING=on
MCP_HUB_MAX_EVIDENCE_REFS_PER_CALL=16
MCP_HUB_MAX_EVIDENCE_REF_CHARS=256
MCP_HUB_ARTIFACT_MAX_BYTES=52428800
MCP_HUB_ARTIFACT_TICKET_TTL_SEC=300
MCP_HUB_ARTIFACT_UPLOAD_TTL_SEC=300
MCP_HUB_ARTIFACT_DOWNLOAD_TTL_SEC=180
MCP_HUB_ARTIFACT_RETENTION_SEC=86400
